const getInfo=async(e,a)=>{let o={};o.headers={Authorization:`Bearer ${a}`,"Content-Type":"application/json",Accept:"application/json"};const n=await fetch(`${urlApi}/${e}`,o);if(401!==n.status){return await n.json()}alert("El token enviado no es vÃ¡lido")},generarGenograma=e=>{var a=go.GraphObject.make;function o(e){switch(e){case"A":return"#00af54";case"B":return"#f27935";case"C":return"#d4071c";case"D":return"#70bdc2";case"E":return"#fcf384";case"F":return"#e69aaf";case"G":return"#08488f";case"H":return"#866310";case"I":return"#9270c2";case"J":return"#a3cf62";case"K":return"#91a4c2";case"L":return"#af70c2";case"S":return"#d4071c";case"V1":case"V2":case"V3":case"V4":return"#54D6E3";case"D1":case"D2":case"D3":case"D4":return"#35A629";default:return"transparent"}}myDiagram=a(go.Diagram,"myDiagramDiv",{initialAutoScale:go.Diagram.Uniform,"undoManager.isEnabled":!0,nodeSelectionAdornmentTemplate:a(go.Adornment,"Auto",{layerName:"Grid"},a(go.Shape,"Circle",{fill:"#c1cee3",stroke:null}),a(go.Placeholder,{margin:2})),layout:a(GenogramLayout,{direction:90,layerSpacing:50,columnSpacing:10})}),myDiagram.add(a(go.Part,{layerName:"Background",position:new go.Point(0,0),selectable:!1,pickable:!1},a(go.Picture,"./assets/images/fafh.png")));var n=go.Geometry.parse("F M1 1 l19 0 0 19 -19 0z"),t=go.Geometry.parse("F M20 1 l19 0 0 19 -19 0z"),r=go.Geometry.parse("F M20 20 l19 0 0 19 -19 0z"),i=go.Geometry.parse("F M1 20 l19 0 0 19 -19 0z"),d=go.Geometry.parse("F M38 0 L40 0 40 2 2 40 0 40 0 38z");var s=go.Geometry.parse("F M20 20 B 180 90 20 20 19 19 z"),c=go.Geometry.parse("F M20 20 B 270 90 20 20 19 19 z"),l=go.Geometry.parse("F M20 20 B 0 90 20 20 19 19 z"),g=go.Geometry.parse("F M20 20 B 90 90 20 20 19 19 z");myDiagram.nodeTemplateMap.add("M",a(go.Node,"Vertical",{locationSpot:go.Spot.Center,locationObjectName:"ICON",selectionObjectName:"ICON"},a(go.Panel,{name:"ICON"},a(go.Shape,"Square",{width:40,height:40,strokeWidth:2,fill:"white",stroke:"#919191",portId:""}),a(go.Panel,{itemTemplate:a(go.Panel,a(go.Shape,{stroke:null,strokeWidth:0},new go.Binding("fill","",o),new go.Binding("geometry","",function(e){switch(e){case"V1":return n;case"V2":return t;case"V3":return r;case"V4":return i;case"D1":return n;case"D2":return t;case"D3":return r;case"D4":return i;case"A":case"B":case"C":return n;case"D":case"E":case"F":return t;case"G":case"H":case"I":return r;case"J":case"K":case"L":return i;case"S":return d;default:return n}}))),margin:1},new go.Binding("itemArray","a"))),a(go.TextBlock,{textAlign:"center",maxSize:new go.Size(80,NaN)},new go.Binding("text","n")))),myDiagram.nodeTemplateMap.add("F",a(go.Node,"Vertical",{locationSpot:go.Spot.Center,locationObjectName:"ICON",selectionObjectName:"ICON"},a(go.Panel,{name:"ICON"},a(go.Shape,"Circle",{width:40,height:40,strokeWidth:2,fill:"white",stroke:"#a1a1a1",portId:""}),a(go.Panel,{itemTemplate:a(go.Panel,a(go.Shape,{stroke:null,strokeWidth:0},new go.Binding("fill","",o),new go.Binding("geometry","",function(e){switch(e){case"A":case"B":case"C":return s;case"D":case"E":case"F":return c;case"V1":return s;case"V2":return c;case"V3":return l;case"V4":return g;case"D1":return s;case"D2":return c;case"D3":return l;case"D4":return g;case"G":case"H":case"I":return l;case"J":case"K":case"L":return g;case"S":return d;default:return s}}))),margin:1},new go.Binding("itemArray","a"))),a(go.TextBlock,{textAlign:"center",maxSize:new go.Size(80,NaN)},new go.Binding("text","n")))),myDiagram.nodeTemplateMap.add("LinkLabel",a(go.Node,{selectable:!1,width:1,height:1,fromEndSegmentLength:20})),myDiagram.linkTemplate=a(go.Link,{routing:go.Link.Orthogonal,corner:5,layerName:"Background",selectable:!1,fromSpot:go.Spot.Bottom,toSpot:go.Spot.Top},a(go.Shape,{stroke:"#424242",strokeWidth:2})),myDiagram.linkTemplateMap.add("Marriage",a(go.Link,{selectable:!1},a(go.Shape,{strokeWidth:2.5,stroke:"#5d8cc1"}))),setupDiagram(myDiagram,e,null)};function setupDiagram(e,a,o){e.model=go.GraphObject.make(go.GraphLinksModel,{linkLabelKeysProperty:"labelKeys",nodeCategoryProperty:"s",copiesArrays:!0,nodeDataArray:a}),setupMarriages(e),setupParents(e);var n=e.findNodeForKey(o);null!==n&&e.select(n)}function findMarriage(e,a,o){var n=e.findNodeForKey(a),t=e.findNodeForKey(o);if(null!==n&&null!==t)for(var r=n.findLinksBetween(t);r.next();){var i=r.value;if(null!==i.data&&"Marriage"===i.data.category)return i}return null}function setupMarriages(e){for(var a=e.model,o=a.nodeDataArray,n=0;n<o.length;n++){var t=o[n],r=t.key,i=t.ux;if(void 0!==i){"number"==typeof i&&(i=[i]);for(var d=0;d<i.length;d++){var s=i[d];if(r!==s)if(null===findMarriage(e,r,s)){var c={s:"LinkLabel"};a.addNodeData(c);var l={from:r,to:s,labelKeys:[c.key],category:"Marriage"};a.addLinkData(l)}}}var g=t.vir;if(void 0!==g){"number"==typeof g&&(g=[g]);for(d=0;d<g.length;d++){var u=g[d];if(r!==u)if(null===findMarriage(e,r,u)){c={s:"LinkLabel"};a.addNodeData(c);l={from:r,to:u,labelKeys:[c.key],category:"Marriage"};a.addLinkData(l)}}}}}function setupParents(e){for(var a=e.model.nodeDataArray,o=0;o<a.length;o++){var n=a[o],t=n.key,r=n.m,i=n.f;if(void 0!==r&&void 0!==i){var d=findMarriage(e,r,i);if(null===d){window.console;continue}var s={from:d.data.labelKeys[0],to:t};myDiagram.model.addLinkData(s)}}}function GenogramLayout(){go.LayeredDigraphLayout.call(this),this.initializeOption=go.LayeredDigraphLayout.InitDepthFirstIn,this.spouseSpacing=30}function generatePdf(e,a,o){if(!(a instanceof go.Diagram))throw new Error("no Diagram provided when calling generatePdf");o||(o={});var n=o.pageSize||"LETTER";if("LETTER"!==(n=n.toUpperCase())&&"A4"!==n)throw new Error("unknown page size: "+n);var t=96*("LETTER"===n?612:595.28)/72,r=96*("LETTER"===n?792:841.89)/72,i=o.layout||"portrait";if("portrait"!==(i=i.toLowerCase())&&"landscape"!==i)throw new Error("unknown layout: "+i);if("landscape"===i){var d=t;t=r,r=d}var s=void 0!==o.margin?o.margin:36,c=void 0!==o.padding?o.padding:a.padding,l=void 0!==o.imgWidth?o.imgWidth:t-s/72*96*2,g=void 0!==o.imgHeight?o.imgHeight:r-s/72*96*2,u=void 0!==o.imgResolutionFactor?o.imgResolutionFactor:3,m={size:n,margin:s,layout:i};require(["blob-stream","pdfkit"],function(n,t){for(var r=new t(m),i=r.pipe(n()),d=(a.documentBounds,a.documentBounds.copy().subtractMargin(a.padding).addMargin(c)),s=d.position,p=0;p<d.height;p+=g)for(var f=0;f<d.width;f+=l){var h=new go.Rect(s.x+f,s.y+p,l,g);if(0!==a.findPartsIn(h,!0,!1).count){(f>0||p>0)&&r.addPage(m);var y={};void 0!==o.parts&&(y.parts=o.parts),void 0!==o.background&&(y.background=o.background),void 0!==o.showTemporary&&(y.showTemporary=o.showTemporary),void 0!==o.showGrid&&(y.showGrid=o.showGrid),y.scale=u,y.position=new go.Point(s.x+f,s.y+p),y.size=new go.Size(l*u,g*u),y.maxSize=new go.Size(1/0,1/0);var w=a.makeImageData(y);r.image(w,{scale:1/(96*u/72)})}}r.end(),i.on("finish",function(){e(i.toBlob("application/pdf"))})})}go.Diagram.inherit(GenogramLayout,go.LayeredDigraphLayout),GenogramLayout.prototype.makeNetwork=function(e){var a=this.createNetwork();return e instanceof go.Diagram?(this.add(a,e.nodes,!0),this.add(a,e.links,!0)):e instanceof go.Group?this.add(a,e.memberParts,!1):e.iterator&&this.add(a,e.iterator,!1),a},GenogramLayout.prototype.add=function(e,a,o){for(var n=new go.Set,t=a.iterator;t.next();){if((u=t.value)instanceof go.Node&&(u.isLayoutPositioned&&u.isVisible()&&(!o||null===u.containingGroup)))if(u.isLinkLabel){var r=(c=u.labeledLink).fromNode,i=c.toNode;(s=e.addNode(u)).width=r.actualBounds.width+this.spouseSpacing+i.actualBounds.width,s.height=Math.max(r.actualBounds.height,i.actualBounds.height),s.focus=new go.Point(r.actualBounds.width+this.spouseSpacing/2,s.height/2)}else{var d=0;if(u.linksConnected.each(function(e){e.isLabeledLink&&d++}),0===d)var s=e.addNode(u);else d>1&&n.add(u)}}for(t.reset();t.next();){var c;if((c=t.value)instanceof go.Link&&(c.isLayoutPositioned&&c.isVisible()&&!(o&&null!==c.containingGroup||c.isLabeledLink))){var l=e.findVertex(c.fromNode),g=e.findVertex(c.toNode);null!==g?e.linkVertexes(l,g,c):c.toNode.linksConnected.each(function(a){if(a.isLabeledLink){var o=a.labelNodes.first(),n=e.findVertex(o);null!==n&&e.linkVertexes(l,n,c)}})}}for(;n.count>0;){var u=n.first(),m=new go.Set;this.extendCohort(m,u);var p=e.createVertex();e.addVertex(p);d=new go.Set;m.each(function(e){e.linksConnected.each(function(e){d.add(e)})}),d.each(function(a){var o=a.labelNodes.first(),n=e.findVertex(o);null!==n&&e.linkVertexes(p,n,null)}),n.removeAll(m)}},GenogramLayout.prototype.extendCohort=function(e,a){if(!e.has(a)){e.add(a);var o=this;a.linksConnected.each(function(a){a.isLabeledLink&&(o.extendCohort(e,a.fromNode),o.extendCohort(e,a.toNode))})}},GenogramLayout.prototype.assignLayers=function(){go.LayeredDigraphLayout.prototype.assignLayers.call(this);var e=0==this.direction||180==this.direction,a=[];this.network.vertexes.each(function(o){var n=o.layer,t=a[n];void 0===t&&(t=0);var r=e?o.width:o.height;r>t&&(a[n]=r)}),this.network.vertexes.each(function(o){var n=o.layer,t=a[n];e?(o.focus=new go.Point(0,o.height/2),o.width=t):(o.focus=new go.Point(o.width/2,0),o.height=t)})},GenogramLayout.prototype.commitNodes=function(){go.LayeredDigraphLayout.prototype.commitNodes.call(this),this.network.vertexes.each(function(e){null===e.node||e.node.isLinkLabel||(e.node.position=new go.Point(e.x,e.y))});var e=this;this.network.vertexes.each(function(a){if(null!==a.node&&a.node.isLinkLabel){var o=a.node.labeledLink;o.invalidateRoute();var n=o.fromNode,t=o.toNode;if("F"===n.data.s){var r=n;n=t,t=r}var i=e.findParentsMarriageLabelNode(n),d=e.findParentsMarriageLabelNode(t);if(null!==i&&null!==d&&i.position.x>d.position.x){r=n;n=t,t=r}if(n.position=new go.Point(a.x,a.y),t.position=new go.Point(a.x+n.actualBounds.width+e.spouseSpacing,a.y),0===n.opacity){var s=new go.Point(a.centerX-n.actualBounds.width/2,a.y);n.position=s,t.position=s}else if(0===t.opacity){s=new go.Point(a.centerX-t.actualBounds.width/2,a.y);n.position=s,t.position=s}}}),this.network.vertexes.each(function(a){if(!(null===a.node||a.node.linksConnected.count>1)){var o=e.findParentsMarriageLabelNode(a.node);if(null!==o&&1===o.linksConnected.count){var n=e.network.findVertex(o),t=a.node.actualBounds.copy();t.x=n.centerX-a.node.actualBounds.width/2,0===e.diagram.findObjectsIn(t,function(e){return e.part},function(e){return e!==a.node},!0).count&&a.node.move(t.position)}}})},GenogramLayout.prototype.findParentsMarriageLabelNode=function(e){for(var a=e.findNodesInto();a.next();){var o=a.value;if(o.isLinkLabel)return o}return null};var pdfOptions={showTemporary:!0,layout:"landscape",pageSize:"LETTER"};function showPdf(){generatePdf(function(e){var a=window.URL.createObjectURL(e),o=document.getElementById("myFrame");o&&(o.style.display="block",o.src=a,setTimeout(function(){window.URL.revokeObjectURL(a)},1))},myDiagram,pdfOptions)}function downloadPdf(){generatePdf(function(e){var a=window.URL.createObjectURL(e),o=document.createElement("a");if(o.style="display: none",o.href=a,o.download="myDiagram.pdf",void 0!==window.navigator.msSaveBlob)return window.navigator.msSaveBlob(e,o.download),void window.URL.revokeObjectURL(a);document.body.appendChild(o),requestAnimationFrame(function(){o.click(),window.URL.revokeObjectURL(a),document.body.removeChild(o)})},myDiagram,pdfOptions)}function generateImagen(e,a,o){if(!(a instanceof go.Diagram))throw new Error("no Diagram provided when calling generatePdf");o||(o={});var n=o.pageSize||"LETTER";if("LETTER"!==(n=n.toUpperCase())&&"A4"!==n)throw new Error("unknown page size: "+n);var t=96*("LETTER"===n?612:595.28)/72,r=96*("LETTER"===n?792:841.89)/72,i=o.layout||"portrait";if("portrait"!==(i=i.toLowerCase())&&"landscape"!==i)throw new Error("unknown layout: "+i);if("landscape"===i){var d=t;t=r,r=d}var s=void 0!==o.margin?o.margin:36,c=void 0!==o.padding?o.padding:a.padding,l=void 0!==o.imgWidth?o.imgWidth:t-s/72*96*2,g=void 0!==o.imgHeight?o.imgHeight:r-s/72*96*2,u=void 0!==o.imgResolutionFactor?o.imgResolutionFactor:3,m={size:n,margin:s,layout:i};require(["blob-stream","pdfkit"],function(e,n){for(var t=new n(m),r=(a.documentBounds,a.documentBounds.copy().subtractMargin(a.padding).addMargin(c)),i=r.position,d=0;d<r.height;d+=g)for(var s=0;s<r.width;s+=l){var p=new go.Rect(i.x+s,i.y+d,l,g);if(0!==a.findPartsIn(p,!0,!1).count){(s>0||d>0)&&t.addPage(m);var f={};void 0!==o.parts&&(f.parts=o.parts),void 0!==o.background&&(f.background=o.background),void 0!==o.showTemporary&&(f.showTemporary=o.showTemporary),void 0!==o.showGrid&&(f.showGrid=o.showGrid),f.scale=u,f.position=new go.Point(i.x+s,i.y+d),f.size=new go.Size(l*u,g*u),f.maxSize=new go.Size(1/0,1/0);var h=a.makeImageData(f),y=document.createElement("a");y.style="display: none",y.href=h,y.download="Genograma.png",document.body.appendChild(y),requestAnimationFrame(function(){y.click(),window.URL.revokeObjectURL(h),document.body.removeChild(y)})}}})}const generarPng=()=>{generateImagen(function(e){var a=window.URL.createObjectURL(e),o=document.createElement("a");if(o.style="display: none",o.href=a,o.download="Genograma.pdf",void 0!==window.navigator.msSaveBlob)return window.navigator.msSaveBlob(e,o.download),void window.URL.revokeObjectURL(a);document.body.appendChild(o),requestAnimationFrame(function(){o.click(),window.URL.revokeObjectURL(a),document.body.removeChild(o)})},myDiagram,pdfOptions)},init=()=>{let e=new URLSearchParams(location.search);var a=e.get("i"),o=e.get("t");getInfo(a,o).then(e=>{let{data:a}=e;generarGenograma(a)}).catch(e=>{alert("No fue posible generar el Genograma")})};